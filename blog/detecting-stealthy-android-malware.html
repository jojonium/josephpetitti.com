<!doctype html>
<html lang="en-US">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>Detecting stealthy Android malware</title>
    <meta name="description" content="A brief outline of my goals and approach to my thesis project, using Android UI context to enable the detection of stealthy malware." />
    <meta property="og:title" content="Detecting stealthy Android malware" />
    <meta property="og:description" content="A brief outline of my goals and approach to my thesis project, using Android UI context to enable the detection of stealthy malware." />
    <meta property="og:image" content="https://josephpetitti.com/blog/images/appjudicator-diagram.png" />
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://josephpetitti.com/blog/detecting-stealthy-android-malware" />
    <meta name="viewport" content="initial-scale=1.0, width=device-width" />

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/images/favicon-16.png" sizes="16x16" type="image/png">
    <link rel="icon" href="/images/favicon-96.png" sizes="96x96" type="image/png">
    <link rel="icon" href="/images/favicon-192.png" sizes="192x192" type="image/png">
    <link rel="icon" href="/images/favicon-32.png" sizes="32x32" type="image/png">
    <meta name="theme-color" content="#1f0053">

    <link rel="stylesheet" href="../webfonts/fonts.css" type="text/css">
    <link href="../styles/dark.css?v=1.0.8" rel="stylesheet" type="text/css">
    <link href="../styles/blog.css" rel="stylesheet" type="text/css">
  </head>
  <body>

  <!-- Header -->
    <header class="article">
      <a id="home-button" href="../index" title="Home">
        Home
      </a>

      <a id="blog-index-button" href="../blog" title="Blog Index">
        Blog Index
      </a>
    </header>

  <!-- Main -->
    <main id="main" class="blog">

      <span class="date">Joseph Petitti &mdash; <time datetime="2021-03-21">March 21, 2021</span>

      <h1 class="title">Detecting stealthy Android malware</h1>

      <p>
        If you stay up to date with this blog you may have noticed I haven't
        made a new post in a while (about four months to be precise). There is a
        reason for this, and it's not just that I'm getting lazy. I've been
        working on a Master of Science degree at WPI, and my thesis project has
        been consuming all my free time. Now that I'm approaching the end of the
        project and the submission of my thesis paper I can write a bit about
        what I've been working on.
      </p>

      <hr>

      <h2 id="the-problem">The problem</h2>

      <p>
        Current corporate network administration tools have too little insight
        into the connections made by employee-owned smartphones, especially in
        "Bring Your Own Device" (BYOD) scenarios that are becoming increasingly
        common. It is difficult for large organizations to maintain security
        across their networks with such little knowledge about&mdash;and control
        over&mdash;these mobile devices. The fact that these devices enter and
        exit the corporate network and connect to other networks, such as their
        cellular data provider's, on a daily basis complicates this issue.
        Smartphones have a wide range of powerful networking and computational
        abilities, and are typically privately owned by employees, which raises
        further concerns when integrating them into secure network environments.
      </p>

      <p>
        For example, smartphones have been targeted by malware specifically
        designed to infiltrate corporate
        networks,<sup title="Kan (2016)"><a href="#kan2016">1</a></sup> such as
        "Dresscode," which disguises itself as a legitimate app in order
        to steal data and add infected devices to a
        botnet.<sup title="Palmer (2016)"><a href="#palmer2016">2</a></sup> The
        "xHelper" malware can automatically download and install arbitrary
        software specified by an attacker, and persists even after a factory
        reset.<sup title="Vijayan (2020)"><a href="#vijayan2020">3</a></sup> A
        black market malware-as-a-service model called Black Rose Lucy even
        offers control of infected Android devices to paying customers,
        potentially giving any malicious actor an entry point to a secure
        network.<sup title="Wong (2018)"><a href="#wong2018">4</a></sup>
      </p>

      <p>
        If mobile devices are to have access to sensitive corporate networks,
        administrators need new tools to monitor and control their network
        connections. These tools need to be powerful enough to detect when
        network connections are made by Trojan horse malware that is disguised
        as a benign app, while being still being easy to deploy and manage. For
        example, some existing solutions require recompiling Android’s kernel or
        gaining root access to their device, which is impractical for most users
        and exposes them to additional security
        risks.<sup title="Google (2020)"><a href="#google2020">5</a></sup>
      </p>

      <h2 id="how-we-solve-it">How we solve it</h2>

      <p>
        To solve these issues on Android devices, we propose a new app called
        which leverages user interface (UI) interaction and software defined
        networking (SDN) principles to determine whether network flows are
        legitimately user-initiated. The app has two components: an
        accessibility service that monitors UI interaction, and a VPN service
        that intercepts network flows and acts as an OpenFlow agent. We use
        these two sources of information to correlate network flows with user
        interaction in a way that is difficult for malware to evade, since it
        cannot physically interact with hardware input devices.
      </p>

      <p>
        The UI monitoring component will use Android's accessibility API to
        asynchronously record user actions. This gives administrators the
        ability to accurately distinguish between human-driven and automated
        network requests. Meanwhile, the VPN service acts as an OpenFlow agent
        and rule cache, giving administrators fine-grained control over which
        connections the device is allowed to make. Flows are augmented with
        context from the specific device and application, and can be elevated to
        the organization's SDN controller if necessary.
      </p>

      <figure class="full-width">
        <a href="images/appjudicator-diagram.png">
          <img src="images/appjudicator-diagram.png" alt="Diagram of the internal components of Appjudicator and how they work together">
        </a>
      </figure>


      <h2 id="benefit-over-cost">Benefit over cost</h2>

      <p>
        Our application provides organizations with a new set of powerful, easy
        to use tools for monitoring BYOD Android smartphones in a simple app
        package that is easy for users to install. It does not require rooting,
        recompiling the kernel, or any other cumbersome processes. It can
        distinguish between user-generated and automated network requests with a
        high degree of confidence using techniques that are difficult for
        malware to evade. This makes users safer by detecting stealthy malware
        on their devices, and improves the organizations network security.
      </p>

      <p>
        The costs of our system include the resource overhead of running the app
        (CPU cycles, battery power, etc.) and the cost of installing, running,
        and maintaining the controller server. We expect these costs to be a
        relatively small addition to existing resources. The app's UI monitoring
        and VPN service will also add some amount of latency to actions
        performed on the phone, but from experience developing a similar
        application for Microsoft Windows, called Harbinger, we expect this
        latency to be within acceptable
        levels.<sup title="Chuluundorj (2019)"><a href="#chuluundorj2019">6</a></sup>
        Harbinger introduced a maximum of six milliseconds of latency for 96% of
        network flows. For context, less than 16 milliseconds is undetectable on
        a standard 60 Hz display.
      </p>

      <h2 id="prior-work">Prior work</h2>

      <p>
        Some aspects of this project have been studied by others before, but
        combines these aspects in new and important ways. Using a smartphone as
        an SDN agent has been investigated by
        Hanguard,<sup title="Demetriou (2017)"><a href="#demetriou2017">7</a></sup>
        and using UI interaction as context for identifying malicious app
        behavior was examined in
        AppIntent,<sup title="Yang (2013)"><a href="#yang2013">8</a></sup>
        but our system combines these approaches to form a novel solution for a
        distinct use case. One key difference is that AppIntent uses machine
        learning to conduct static analysis of apps, while  enables live
        monitoring and response to malicious network flows in real time.
      </p>

      <p>
        The combination of UI monitoring and SDN has been implemented on
        Microsoft Windows by
        Harbinger,<sup title="Chuluundorj (2019)"><a href="#chuluundorj2019">6</a></sup>
        and Kwon et al.,<sup title="Kwon (2011)"><a href="#kwon2011">9</a></sup>
        but we solve new challenges presented by the Android platform. For
        example, we are constrained by Android's rigid permissions system, we do
        not have root access to the device, and we cannot modify the kernel.
        These restrictions require novel techniques and systems.
      </p>

      <p>
        Our work will focus on exploring the following research question:
      </p>

      <figure class="full-width">
        <p class="quote">Can UI interaction and network activity be used to successfully
        predict and associate network flows with user actions on Android devices
        with acceptable overhead?</p>
      </figure>

      <p>
        To investigate we will perform a study with several popular Google Play
        apps to determine whether  can successfully detect and block suspicious
        non-user-initiated network requests. We will also measure the total
        round-trip-time of network requests with the system enabled and disabled
        to determine the total latency it adds.
      </p>

      <hr>

      <p>
        This is just a basic outline of my goals and approach to the project. In
        the coming weeks I expect to post a bit more about the specific
        implementation details, so stay tuned for that.
      </p>

      <h2 id="references">References</h2>

      <ol class="references-list">

      <li id="kan2016" class="csl-entry" role="doc-biblioentry">
        Kan, Michael. 2016. <span>"<span>Android</span> Malware That Can
          Infiltrate Corporate Networks Is Spreading."</span> <a href="https://www.computerworld.com/article/3126390/android-malware-that-can-infiltrate-corporate-networks-is-spreading.html" target="_blank" rel="noreferrer noopener">https://www.computerworld.com/article/3126390/android-malware-that-can-infiltrate-corporate-networks-is-spreading.html</a>.
      </li>

      <li id="palmer2016" class="csl-entry" role="doc-biblioentry">
        Palmer, Danny. 2016. <span>"Over 400 Instances of Dresscode Malware
          Found on Google Play Store, Say Researchers."</span> ZDNet. <a href="https://www.zdnet.com/article/over-400-instances-of-dresscode-malware-found-on-google-play-store-say-researchers/" target="_blank" rel="noreferrer noopener">https://www.zdnet.com/article/over-400-instances-of-dresscode-malware-found-on-google-play-store-say-researchers/</a>.
      </li>

      <li id="vijayan2020" class="csl-entry" role="doc-biblioentry">
        Vijayan, Jai. 2020. <span>"<span>'Unkillable'</span>
          <span>Android</span> Malware App Continues to Infect Devices
          Worldwide."</span> <a href="https://www.darkreading.com/mobile/unkillable-android-malware-app-continues-to-infect-devices-worldwide/d/d-id/1337519" target="_blank" rel="noreferrer noopener">https://www.darkreading.com/mobile/unkillable-android-malware-app-continues-to-infect-devices-worldwide/d/d-id/1337519</a>.
      </li>

      <li id="wong2018" class="csl-entry" role="doc-biblioentry">
        Wong, Wylie. 2018. <span>"New Malware-as-a-Service Threat Targets
          <span>Android</span> Phones."</span> <a href="https://securityintelligence.com/news/new-malware-as-a-service-threat-targets-android-phones/" target="_blank" rel="noreferrer noopener">https://securityintelligence.com/news/new-malware-as-a-service-threat-targets-android-phones/</a>.
      </li>

      <li id="google2020" class="csl-entry" role="doc-biblioentry">
        Google. 2020. <span>"Security Risks with Modified (Rooted)
          <span>Android</span> Versions."</span> <a href="https://support.google.com/accounts/answer/9211246?hl=en" target="_blank" rel="noreferrer noopener">https://support.google.com/accounts/answer/9211246?hl=en</a>.
      </li>

      <li id="chuluundorj2019" class="csl-entry" role="doc-biblioentry">
        Chuluundorj, Zorigtbaatar. 2019. <span>"Augmenting Network Flows with
          User Interface Context to Inform Access Control Decisions."</span>
        Master's thesis, Worcester Polytechnic Institute. <a href="https://digitalcommons.wpi.edu/etd-theses/1331" target="_blank" rel="noreferrer noopener">https://digitalcommons.wpi.edu/etd-theses/1331</a>.
      </li>

      <li id="demetriou2017" class="csl-entry" role="doc-biblioentry">
        Demetriou, Soteris, Nan Zhang, Yeonjoon Lee, XiaoFeng Wang, Carl A
        Gunter, Xiaoyong Zhou, and Michael Grace. 2017. <span>"HanGuard:
        SDN-Driven Protection of Smart Home WiFi Devices from Malicious Mobile
      Apps."</span> In <em>Proceedings of the 10th ACM Conference on Security
      and Privacy in Wireless and Mobile Networks</em>, 122–33.
      </li>

      <li id="yang2013" class="csl-entry" role="doc-biblioentry">
        Yang, Zhemin, Min Yang, Yuan Zhang, Guofei Gu, Peng Ning, and X Sean
        Wang. 2013. <span>"<span>AppIntent</span>: Analyzing Sensitive Data
        Transmission in <span>Android</span> for Privacy Leakage
      Detection."</span> In <em>Proceedings of the 2013 ACM SIGSAC Conference on
      Computer &amp; Communications Security</em>, 1043–54.
      </li>

      <li id="kwon2011" class="csl-entry" role="doc-biblioentry">
        Kwon, Jonghoon, Jehyun Lee, and Heejo Lee. 2011. <span>"Hidden Bot
          Detection by Tracing Non-Human Generated Traffic at the Zombie
          Host."</span> In <em>International Conference on Information Security
        Practice and Experience</em>, 343–61. Springer.
      </li>

    </ol>
    </main>

  <!-- Footer -->
    <footer id="footer" class="article">
      <section class="about">
        <h2>About this website</h2>

        <p>
          I created this website as a personal project in my free time
          to learn more about web design, CSS, HTML, and JavaScript.
        </p>

        <p>
         All text on this site is released under the
         <a href="https://creativecommons.org/licenses/by/3.0/" target="_blank" rel="noreferrer noopener">CC BY 3.0</a>
         license. Scripts are released under various free and open source
         <a href="/licenses" rel="jslicense">licenses</a> by their respective
         authors. The entire source code of the site can be seen on
         <a href="https://github.com/jojonium/josephpetitti.com" target="_blank" rel="noreferrer noopener">GitHub</a>.
        </p>
      </section>
    </footer>
  </body>
</html>
